!function(e){"use strict";hivepress.initGeolocation=function(t){t.find(hivepress.getSelector("location")).each(function(){var t=e(this),n=t.closest("form"),a=t.find("input[type=text]"),o=n.find("input[data-coordinate=lat]"),i=n.find("input[data-coordinate=lng]"),r=n.find("input[data-region]"),s=t.find("a"),l={};"undefined"!=typeof mapboxData?(l={accessToken:mapboxData.apiKey,language:hivepressCoreData.language},t.data("countries")&&(l.countries=t.data("countries").join(",")),t.data("types")&&(l.types=t.data("types").join(",")),t.find("input").autocomplete({delay:500,minLength:3,source:function(t,n){e.ajax({method:"GET",dataType:"json",url:"https://nominatim.openstreetmap.org/search?q="+t.term+"&format=geojson&polygon_geojson=0&addressdetails=1&countrycodes="+l.countries,success:function(e){n(e.features.map(function(e,t,n){return{label:e.properties.display_name,value:e.properties.name,place:e.properties.address.town,district:e.properties.address.county,country:e.properties.address.country,region:e.properties.address["ISO3166-2-lvl6"],lat:e.geometry.coordinates[1],long:e.geometry.coordinates[0]}}))},error:function(){n([])}})},select:function(t,n){console.log(n),t.preventDefault(),e(t.target).val(n.item.value);var a=["place","district","region","country",];r.length&&(n.item.filter(e=>a.includes(e)).length?r.val(n.item.region):r.val("")),i.val(n.item.long),o.val(n.item.lat),console.log("You selected: "+n.item.value+", "+n.item.label)},focus:function(t,n){t.preventDefault(),e(t.target).val(n.item.value)}}).on("keyup",function(t){0==e(t.target).val().length&&e("#selection-ajax").html("")}).data("ui-autocomplete")._renderItem=function(t,n){for(var a,o,i,r=e("<div></div>").text(n.label),s=e.trim(this.term).toLowerCase(),l=r.get(0).firstChild;(a=l.data.toLowerCase().indexOf(s))>=0;)l=(o=l.splitText(a)).splitText(s.length),(i=document.createElement("span")).className="highlight",l.parentNode.insertBefore(i,l),i.appendChild(o);return e("<li></li>").append(r).appendTo(t)}):(l={details:n,detailsAttribute:"data-coordinate"},t.data("countries")&&(l.componentRestrictions={country:t.data("countries")}),t.data("types")&&(l.types=t.data("types")),a.geocomplete(l),a.bind("geocode:result",function(n,o){var i=[],s=["locality","administrative_area_level_2","administrative_area_level_1","country",];r.length&&(o.address_components[0].types.filter(e=>s.includes(e)).length?r.val(o.place_id):r.val("")),t.data("scatter")&&(s.push("route"),e.each(o.address_components,function(e,t){t.types.filter(e=>s.includes(e)).length&&i.push(t.long_name)}),a.val(i.join(", ")))})),a.on("input",function(){a.val()||n.find("input[data-coordinate]").val("")}),navigator.geolocation?s.on("click",function(e){navigator.geolocation.getCurrentPosition(function(e){"undefined"!=typeof mapboxData?console.log(e):a.geocomplete("find",e.coords.latitude+" "+e.coords.longitude)}),e.preventDefault()}):s.hide()}),t.find(hivepress.getSelector("map")).each(function(){var t=e(this),n=t.width(),a=t.data("max-zoom"),o=t.data("marker");if(t.is("[data-height]")&&(n=t.data("height")),t.height(n),"undefined"!=typeof mapboxData){console.log(t.data("markers"));var i=new maplibregl.LngLatBounds,r=new maplibregl.Map({container:t.get(0),style:{version:8,name:"Blank",center:[0,0],zoom:0,sources:{"raster-tiles":{type:"raster",tiles:["https://tile.openstreetmap.org/{z}/{x}/{y}.png"],tileSize:256,minzoom:0,maxzoom:19}},layers:[{id:"background",type:"background",paint:{"background-color":"#e0dfdf"}},{id:"simple-tiles",type:"raster",source:"raster-tiles"}],id:"blank"},center:[0,0],zoom:1,bearing:20,antialias:!0});r.addControl(new maplibregl.NavigationControl),r.addControl(new maplibregl.FullscreenControl),e.each(t.data("markers"),function(e,t){i.extend([t.longitude,t.latitude]),new maplibregl.Marker().setLngLat([t.longitude,t.latitude]).setPopup(new maplibregl.Popup().setHTML(t.content)).addTo(r)}),r.fitBounds(i,{maxZoom:a-1,padding:150,duration:0}),new ResizeObserver(function(){r.resize(),r.fitBounds(i,{maxZoom:a-1,padding:150,duration:0})}).observe(t.get(0))}else{var s=!1,l=[],i=new google.maps.LatLngBounds,r=new google.maps.Map(t.get(0),{zoom:3,minZoom:2,maxZoom:a,mapTypeControl:!1,streetViewControl:!1,center:{lat:0,lng:0},styles:[{featureType:"poi",stylers:[{visibility:"off"}]}]}),d=new OverlappingMarkerSpiderfier(r,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0}),c={path:google.maps.SymbolPath.CIRCLE,fillColor:"#3a77ff",fillOpacity:.25,strokeColor:"#3a77ff",strokeWeight:1,strokeOpacity:.75,scale:10};e.each(t.data("markers"),function(e,n){var a=new google.maps.InfoWindow({content:n.content}),u={title:n.title,position:{lat:n.latitude,lng:n.longitude}};o&&(u.icon={url:o,scaledSize:new google.maps.Size(50,50)}),t.data("scatter")&&(u.icon=c);var p=new google.maps.Marker(u);p.addListener("spider_click",function(){s&&s.close(),s=a,a.open(r,p)}),l.push(p),d.addMarker(p),i.extend(p.getPosition())}),r.fitBounds(i),new ResizeObserver(function(){r.fitBounds(i)}).observe(t.get(0)),new MarkerClusterer(r,l,{imagePath:hivepressGeolocationData.assetURL+"/images/markerclustererplus/m",maxZoom:a-1}),t.data("scatter")&&r.addListener("zoom_changed",function(){c.scale=Math.pow(1.3125,r.getZoom()),e.each(l,function(e,t){l[e].setIcon(c)})})}})},e(document).on("hivepress:init",function(e,t){hivepress.initGeolocation(t)})}(jQuery);